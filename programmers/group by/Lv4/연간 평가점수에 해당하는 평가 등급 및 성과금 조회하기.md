```sql
-- Lv.4
-- 연간 평가점수에 해당하는 평가 등급 및 성과금 조회하기

WITH emp_grade AS (
    SELECT
        emp_no,
        CASE 
            WHEN avg_score >= 96 THEN 'S'
            WHEN avg_score >= 90 THEN 'A'
            WHEN avg_score >= 80 THEN 'B'
            ELSE 'C'
        END AS grade
    FROM (
        SELECT
            emp_no,
            SUM(score) / 2 AS avg_score
        FROM hr_grade
        GROUP BY emp_no
    ) a
)

SELECT
    a.emp_no,
    b.emp_name,
    a.grade,
    CASE
        WHEN grade = 'S' THEN b.sal * 0.2
        WHEN grade = 'A' THEN b.sal * 0.15
        WHEN grade = 'B' THEN b.sal * 0.1
        ELSE 0
    END AS bonus
FROM emp_grade a
JOIN hr_employees b ON a.emp_no = b.emp_no
ORDER BY emp_no;
```
```sql
-- Lv.4
-- 특정 기간동안 대여 가능한 자동차들의 대여비용 구하기

WITH CTE AS (
    SELECT A.CAR_ID, A.CAR_TYPE, A.DAILY_FEE
    FROM CAR_RENTAL_COMPANY_CAR A
    JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY B ON A.CAR_ID = B.CAR_ID
    WHERE A.CAR_ID NOT IN (
            SELECT CAR_ID
            FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
            WHERE START_DATE <= '2022-11-30' AND END_DATE >= '2022-11-01'
        )
        AND A.CAR_TYPE IN ('SUV', '세단')
),
CTE2 AS (
    SELECT DISTINCT A.CAR_ID, A.CAR_TYPE,
        ROUND((A.DAILY_FEE - (A.DAILY_FEE * B.DISCOUNT_RATE / 100)) * 30) AS FEE
    FROM CTE A
    JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN B ON A.CAR_TYPE = B.CAR_TYPE
    WHERE B.DURATION_TYPE = '30일 이상'
)

SELECT *
FROM CTE2
WHERE FEE >= 500000 AND FEE < 2000000
ORDER BY FEE DESC, CAR_TYPE ASC, CAR_ID DESC;
```